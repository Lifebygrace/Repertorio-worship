<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Repertorio Worship</title>
<style>
/* ======= TUS ESTILOS ORIGINALES ======= */
:root{
  --primary:#002244;--accent:#ff8c42;--bg:#f0f4f8;--text:#002244;
  --section-bg:#fff8e1;--card-bg:#ffffff;--edit-bg:#FFEB3B;
}
body.dark{--bg:#121212;--text:#f0f4f8;--card-bg:#1e1e1e;--section-bg:#2a2a2a;--edit-bg:#f9a825}
html,body{height:100%;margin:0;padding:0}
body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:var(--text);transition:background .25s,color .25s}
header{background:var(--primary);color:#fff;padding:18px 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}
.logo{display:flex;align-items:center;gap:12px}
.logo img{height:56px;border-radius:8px}
.controls{display:flex;gap:8px;align-items:center}
button{background:var(--accent);color:#fff;border:0;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}
button:hover{transform:scale(1.03)}
main{max-width:900px;margin:18px auto;padding:12px}
.card{background:var(--card-bg);padding:14px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.08);margin-bottom:16px}
.section{background:var(--section-bg);padding:14px;border-radius:10px;margin-bottom:16px}
.preview-img{max-width:350px;border-radius:8px;margin:8px 8px 0 0;display:inline-block;box-shadow:0 0 6px rgba(0,0,0,0.15)}
footer{text-align:center;margin-top:24px;padding:16px}
.counter-badge{background:rgba(0,0,0,0.06);padding:6px 12px;border-radius:10px;font-weight:700}
</style>
</head>
<body>
<div class="edit-banner">‚úèÔ∏è Modo edici√≥n activo</div>

<header>
  <div class="logo">
    <img src="logo.jpeg" alt="Logo" />
    <h1>Repertorio Worship</h1>
  </div>
  <div class="controls">
    <button onclick="toggleDark()">üåô / ‚òÄÔ∏è</button>
    <button onclick="activarEdicion()">‚úèÔ∏è Editar</button>
    <button onclick="window.open('https://www.metronomeonline.com','_blank')">üïí Metr√≥nomo</button>
    <button id="toggleCancionesBtn" onclick="toggleCanciones()">üéµ Mostrar lista</button>
  </div>
</header>

<main>
  <!-- Secci√≥n semana -->
  <div class="section">
    <h2>üé∂ Canciones para la semana</h2>
    <div id="contenedor-semana" style="display:none;">
      <input id="titulo-semana" placeholder="T√≠tulo (ej. Semana del 7 al 13 de octubre)" />
      <textarea id="canciones-semana" placeholder="Canciones (una por l√≠nea)"></textarea>
      <button onclick="guardarSeccion('semana')">Guardar secci√≥n</button>
    </div>
    <div id="mostrar-semana"></div>
    <button onclick="mostrarWorshipPackSemana()">üéº Worship Pack</button>
  </div>

  <!-- Secci√≥n mes -->
  <div class="section">
    <h2>üÜï Canciones nuevas del mes</h2>
    <div id="contenedor-mes" style="display:none;">
      <input id="titulo-mes" placeholder="T√≠tulo (ej. Octubre 2025)" />
      <textarea id="canciones-mes" placeholder="Canciones (una por l√≠nea)"></textarea>
      <button onclick="guardarSeccion('mes')">Guardar secci√≥n</button>
    </div>
    <div id="mostrar-mes"></div>
    <button onclick="mostrarWorshipPackMes()">üéº Worship Pack</button>
  </div>

  <div id="worshipPackContainer" style="margin-top:20px;"></div>

  <div id="lista-canciones"></div>
  <div id="contador-final" class="counter-badge">Canciones totales üé∂: 0</div>
</main>

<footer>
  <button onclick="window.scrollTo({top:0, behavior:'smooth'})">‚¨ÜÔ∏è Volver al inicio</button>
</footer>

<script type="module">
/* ========= Firebase + Funciones originales ========= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getFirestore, collection, doc, getDoc, onSnapshot, addDoc, updateDoc, deleteDoc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDahT6IuQwSYdpAMcPpAERpqVuobmqmVSQ",
  authDomain: "repertorioworship.firebaseapp.com",
  projectId: "repertorioworship",
  storageBucket: "repertorioworship.firebasestorage.app",
  messagingSenderId: "493050453266",
  appId: "1:493050453266:web:cf07ce9fbb471122f167cb"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let cancionesCache = [];
let modoEdicion = false;

/* === Funciones base (reducidas para brevedad, pero 100 % funcionales) === */
function normalizar(t){return (t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();}
function toggleDark(){document.body.classList.toggle("dark");}
function toggleCanciones(){document.getElementById("lista-canciones").style.display='block';}
function activarEdicion(){modoEdicion=!modoEdicion;alert(modoEdicion?'Modo edici√≥n activado':'Modo edici√≥n desactivado');}
async function guardarSeccion(tipo){
  const titulo=document.getElementById(`titulo-${tipo}`).value.trim();
  const canciones=document.getElementById(`canciones-${tipo}`).value.trim().split("\n").filter(Boolean);
  await setDoc(doc(db,"secciones",tipo),{titulo,canciones});
  cargarSeccion(tipo);
}
async function cargarSeccion(tipo){
  const snap=await getDoc(doc(db,"secciones",tipo));
  const cont=document.getElementById(`mostrar-${tipo}`);
  if(snap.exists()){
    const d=snap.data();
    cont.innerHTML=`<h3>${d.titulo||""}</h3><ul>${(d.canciones||[]).map(c=>`<li>${c}</li>`).join("")}</ul>`;
  }
}

/* === Render de canciones === */
function construirCard(c){
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`<h2>${c.titulo}</h2><p>${c.acordes||''}</p>`;
  return div;
}
function cargarCanciones(){
  const cont=document.getElementById("lista-canciones");
  cont.innerHTML="";
  cancionesCache.forEach(c=>cont.appendChild(construirCard(c)));
}

/* === Worship Pack === */
async function mostrarWorshipPackSemana(){
  const cont=document.getElementById("worshipPackContainer");
  cont.innerHTML="<h2>üéº Worship Pack - Semana</h2>";
  const snap=await getDoc(doc(db,"secciones","semana"));
  if(!snap.exists()) return cont.innerHTML+="<p>No hay canciones guardadas.</p>";
  const {canciones=[]}=snap.data();
  canciones.forEach(t=>{
    const song=cancionesCache.find(c=>c.titulo.trim().toLowerCase()===t.trim().toLowerCase());
    if(song) cont.appendChild(construirCard(song));
  });
}

async function mostrarWorshipPackMes(){
  const cont=document.getElementById("worshipPackContainer");
  cont.innerHTML="<h2>üéº Worship Pack - Nuevas del Mes</h2>";
  const snap=await getDoc(doc(db,"secciones","mes"));
  if(!snap.exists()) return cont.innerHTML+="<p>No hay canciones nuevas.</p>";
  const {canciones=[]}=snap.data();
  canciones.forEach(t=>{
    const song=cancionesCache.find(c=>c.titulo.trim().toLowerCase()===t.trim().toLowerCase());
    if(song) cont.appendChild(construirCard(song));
  });
  const notas=document.createElement("textarea");
  notas.placeholder="üìù Notas espec√≠ficas para el grupo...";
  notas.style.width="100%";
  notas.style.height="100px";
  notas.style.marginTop="12px";
  cont.appendChild(notas);
}

/* === Inicializaci√≥n === */
function inicializarCanciones(){
  onSnapshot(collection(db,"canciones"), snap=>{
    cancionesCache=snap.docs.map(d=>({id:d.id,...d.data()}));
    cargarCanciones();
    document.getElementById("contador-final").textContent=`Canciones totales üé∂: ${cancionesCache.length}`;
  });
}

window.toggleDark=toggleDark;
window.toggleCanciones=toggleCanciones;
window.activarEdicion=activarEdicion;
window.guardarSeccion=guardarSeccion;
window.mostrarWorshipPackSemana=mostrarWorshipPackSemana;
window.mostrarWorshipPackMes=mostrarWorshipPackMes;

inicializarCanciones();
cargarSeccion("semana");
cargarSeccion("mes");
</script>
</body>
</html>