<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Repertorio Worship</title>
<style>
  /* B√°sicos y dise√±o */
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0 10px 30px;
    background: white;
    color: #222;
    min-height: 100vh;
  }
  header {
    display: flex;
    justify-content: center;
    align-items: center;
    border-bottom: 2px solid #ccc;
    padding: 10px 0;
    position: relative;
  }
  header img {
    height: 70px;
  }
  #btnMetro {
    position: fixed;
    top: 10px;
    left: 10px;
    background: #007bff;
    color: white;
    border: none;
    padding: 7px 12px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    z-index: 1000;
  }
  #btnArriba {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 14px;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    font-size: 18px;
    z-index: 1000;
  }
  #btnLogin, #btnLogout, #btnModo {
    position: fixed;
    top: 10px;
    right: 10px;
    margin-left: 10px;
    background: transparent;
    border: 1px solid #007bff;
    color: #007bff;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
  }
  #btnLogout {
    right: 90px;
  }
  #btnModo {
    right: 170px;
  }

  #buscador {
    margin: 15px auto;
    max-width: 400px;
    display: block;
    font-size: 16px;
    padding: 8px;
    width: 100%;
    border: 2px solid #007bff;
    border-radius: 5px;
  }
  #contador {
    text-align: center;
    font-weight: bold;
    margin-bottom: 20px;
    color: #007bff;
  }

  .cancion {
    border: 1px solid #ccc;
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 7px;
    background: #f9f9f9;
  }
  .cancion h3 {
    margin: 0 0 5px 0;
  }
  .imagenes {
    display: flex;
    gap: 10px;
    margin: 10px 0;
  }
  .imagenes img {
    max-height: 100px;
    max-width: 150px;
    border-radius: 5px;
    object-fit: contain;
  }
  audio {
    width: 100%;
    margin-top: 5px;
  }
  .btnEliminar {
    background: #d9534f;
    border: none;
    color: white;
    padding: 5px 9px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    float: right;
  }

  .notas-section {
    margin-top: 30px;
    padding: 15px;
    border: 2px solid #007bff;
    border-radius: 7px;
    background: #eef7ff;
  }
  .notas-section h4 {
    margin-top: 0;
    margin-bottom: 8px;
    color: #004a99;
  }
  .notas-section textarea {
    width: 100%;
    height: 80px;
    padding: 8px;
    resize: vertical;
    font-family: inherit;
    font-size: 14px;
    border: 1px solid #007bff;
    border-radius: 4px;
  }
  .notas-section input[type="date"] {
    margin-top: 5px;
    padding: 5px;
    border: 1px solid #007bff;
    border-radius: 4px;
  }
  .editarNotasBtn {
    margin-top: 8px;
    padding: 6px 12px;
    border: none;
    background: #007bff;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
  }

  form#formAgregar {
    margin-top: 30px;
    border: 2px solid #007bff;
    padding: 15px;
    border-radius: 7px;
    background: #f0f8ff;
    max-width: 500px;
  }
  form#formAgregar h3 {
    margin-top: 0;
    color: #004a99;
  }
  form#formAgregar label {
    display: block;
    margin: 10px 0 5px 0;
    font-weight: bold;
  }
  form#formAgregar input[type="text"],
  form#formAgregar input[type="file"] {
    width: 100%;
    padding: 7px;
    border: 1px solid #007bff;
    border-radius: 5px;
    font-size: 14px;
  }
  form#formAgregar button {
    margin-top: 15px;
    background: #007bff;
    border: none;
    color: white;
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }

  footer {
    margin-top: 50px;
    text-align: center;
    font-style: italic;
    color: #666;
    border-top: 1px solid #ccc;
    padding-top: 15px;
  }

  /* Modo oscuro */
  body.dark {
    background: #222;
    color: #eee;
  }
  body.dark header {
    background: #111;
    border-bottom-color: #444;
  }
  body.dark #btnMetro,
  body.dark #btnArriba {
    background: #005bb5;
  }
  body.dark .cancion {
    background: #333;
    border-color: #555;
  }
  body.dark .notas-section {
    background: #333;
  }
  body.dark input, body.dark textarea {
    background: #444;
    color: #eee;
    border-color: #555;
  }
  body.dark button {
    color: white;
  }
</style>
</head>
<body>

<header>
  <img src="logo.jpeg" alt="Logo Worship" />
</header>

<button id="btnMetro" title="Metr√≥nomo">Metro</button>
<button id="btnArriba" title="Volver arriba">‚Üë</button>

<button id="btnModo" title="Modo Oscuro">üåô</button>
<button id="btnLogin" title="Iniciar sesi√≥n">Login</button>
<button id="btnLogout" title="Cerrar sesi√≥n" style="display:none;">Logout</button>

<input type="text" id="buscador" placeholder="Buscar canci√≥n..." />
<div id="contador">0 canciones</div>

<div id="listaCanciones"></div>

<div class="notas-section" id="notasServicioSection" style="display:none;">
  <h4>Notas para el servicio</h4>
  <textarea id="notasServicio" readonly></textarea>
  <br />
  <label>Fecha: <input type="date" id="fechaServicio" disabled /></label>
  <br />
  <button class="editarNotasBtn" id="editarServicio">Editar Notas</button>
</div>

<div class="notas-section" id="notasEnsayoSection" style="display:none;">
  <h4>Canciones a ensayar</h4>
  <textarea id="notasEnsayo" readonly></textarea>
  <br />
  <label>Fecha: <input type="date" id="fechaEnsayo" disabled /></label>
  <br />
  <button class="editarNotasBtn" id="editarEnsayo">Editar Notas</button>
</div>

<form id="formAgregar" style="display:none;">
  <h3>Agregar canci√≥n</h3>
  <label for="nombre">Nombre de la canci√≥n *</label>
  <input type="text" id="nombre" required />
  <label for="urlImagen1">Imagen acorde 1 (m√°x 1 archivo)</label>
  <input type="file" id="urlImagen1" accept="image/*" />
  <label for="urlImagen2">Imagen acorde 2 (m√°x 1 archivo)</label>
  <input type="file" id="urlImagen2" accept="image/*" />
  <label for="urlAudio">Archivo de audio (m√°x 1 archivo)</label>
  <input type="file" id="urlAudio" accept="audio/*" />
  <button type="submit">Agregar canci√≥n</button>
</form>

<footer>
  Efesios 2:8 ‚Äî Porque por gracia sois salvos por medio de la fe; y esto no de vosotros, pues es don de Dios.
</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
  // CONFIGURA TU FIREBASE AQU√ç
  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    storageBucket: "TU_STORAGE_BUCKET",
    messagingSenderId: "TU_MESSAGING_SENDER_ID",
    appId: "TU_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const ADMIN_UID = "Wac5yk1NUQNY1fSARyOxRjacLPV2";

  // Elementos DOM
  const btnLogin = document.getElementById('btnLogin');
  const btnLogout = document.getElementById('btnLogout');
  const btnModo = document.getElementById('btnModo');
  const btnMetro = document.getElementById('btnMetro');
  const btnArriba = document.getElementById('btnArriba');
  const buscador = document.getElementById('buscador');
  const contador = document.getElementById('contador');
  const listaCanciones = document.getElementById('listaCanciones');
  const formAgregar = document.getElementById('formAgregar');
  const nombreInput = document.getElementById('nombre');
  const urlImagen1Input = document.getElementById('urlImagen1');
  const urlImagen2Input = document.getElementById('urlImagen2');
  const urlAudioInput = document.getElementById('urlAudio');

  const notasServicio = document.getElementById('notasServicio');
  const fechaServicio = document.getElementById('fechaServicio');
  const editarServicio = document.getElementById('editarServicio');
  const notasEnsayo = document.getElementById('notasEnsayo');
  const fechaEnsayo = document.getElementById('fechaEnsayo');
  const editarEnsayo = document.getElementById('editarEnsayo');

  let canciones = [];
  let currentUser = null;

  // --- Modo Oscuro ---
  function guardarModo(modo) {
    localStorage.setItem('modoOscuro', modo);
  }
  function cargarModo() {
    const modo = localStorage.getItem('modoOscuro') || 'claro';
    if(modo === 'oscuro') {
      document.body.classList.add('dark');
      btnModo.textContent = '‚òÄÔ∏è';
    } else {
      document.body.classList.remove('dark');
      btnModo.textContent = 'üåô';
    }
  }
  btnModo.onclick = () => {
    if(document.body.classList.contains('dark')) {
      document.body.classList.remove('dark');
      btnModo.textContent = 'üåô';
      guardarModo('claro');
    } else {
      document.body.classList.add('dark');
      btnModo.textContent = '‚òÄÔ∏è';
      guardarModo('oscuro');
    }
  }

  // --- Mostrar canciones ---
  function mostrarCanciones(filtro) {
    const texto = filtro.toLowerCase();
    const filtradas = canciones.filter(c => c.nombre.toLowerCase().includes(texto));
    contador.textContent = `${filtradas.length} canci√≥n${filtradas.length !== 1 ? 'es' : ''}`;
    listaCanciones.innerHTML = '';
    for(const cancion of filtradas) {
      const div = document.createElement('div');
      div.classList.add('cancion');
      div.innerHTML = `<h3>${cancion.nombre}</h3>`;

      // Im√°genes acorde
      const imgs = document.createElement('div');
      imgs.classList.add('imagenes');
      if(cancion.urlImagen1) {
        const img1 = document.createElement('img');
        img1.src = cancion.urlImagen1;
        img1.alt = `Acorde 1 ${cancion.nombre}`;
        imgs.appendChild(img1);
      }
      if(cancion.urlImagen2) {
        const img2 = document.createElement('img');
        img2.src = cancion.urlImagen2;
        img2.alt = `Acorde 2 ${cancion.nombre}`;
        imgs.appendChild(img2);
      }
      div.appendChild(imgs);

      // Audio
      if(cancion.urlAudio) {
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.src = cancion.urlAudio;
        div.appendChild(audio);
      }

      // Bot√≥n eliminar solo admin
      if(currentUser && currentUser.uid === ADMIN_UID) {
        const btnEliminar = document.createElement('button');
        btnEliminar.textContent = 'Eliminar';
        btnEliminar.classList.add('btnEliminar');
        btnEliminar.onclick = () => eliminarCancion(cancion.id);
        div.appendChild(btnEliminar);
      }

      listaCanciones.appendChild(div);
    }
  }

  // --- Cargar canciones ---
  async function cargarCanciones() {
    try {
      const snapshot = await db.collection('canciones').orderBy('nombre').get();
      canciones = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      mostrarCanciones(buscador.value);
    } catch(e) {
      console.error('Error al cargar canciones:', e);
    }
  }

  // --- Agregar canci√≥n ---
  async function agregarCancion(e) {
    e.preventDefault();

    if(!currentUser || currentUser.uid !== ADMIN_UID) {
      alert('Solo el administrador puede agregar canciones.');
      return;
    }

    const nombre = nombreInput.value.trim();
    if(!nombre) {
      alert('El nombre es obligatorio');
      return;
    }

    // Subir im√°genes si hay
    const imagenesURLs = [];
    for (const inputFile of [urlImagen1Input, urlImagen2Input]) {
      if(inputFile.files.length > 0) {
        const file = inputFile.files[0];
        const ref = storage.ref(`imagenes/${Date.now()}_${file.name}`);
        await ref.put(file);
        const url = await ref.getDownloadURL();
        imagenesURLs.push(url);
      } else {
        imagenesURLs.push('');
      }
    }

    // Subir audio si hay
    let urlAudio = '';
    if(urlAudioInput.files.length > 0) {
      const file = urlAudioInput.files[0];
      const ref = storage.ref(`audios/${Date.now()}_${file.name}`);
      await ref.put(file);
      urlAudio = await ref.getDownloadURL();
    }

    try {
      await db.collection('canciones').add({
        nombre,
        urlImagen1: imagenesURLs[0],
        urlImagen2: imagenesURLs[1],
        urlAudio
      });

      // Limpiar form
      nombreInput.value = '';
      urlImagen1Input.value = '';
      urlImagen2Input.value = '';
      urlAudioInput.value = '';

      cargarCanciones();
    } catch(e) {
      alert('Error al agregar canci√≥n');
      console.error(e);
    }
  }

  // --- Eliminar canci√≥n ---
  async function eliminarCancion(id) {
    if(!confirm('¬øEliminar esta canci√≥n?')) return;
    if(!currentUser || currentUser.uid !== ADMIN_UID) {
      alert('Solo el administrador puede eliminar canciones.');
      return;
    }
    try {
      await db.collection('canciones').doc(id).delete();
      cargarCanciones();
    } catch(e) {
      alert('Error al eliminar canci√≥n');
      console.error(e);
    }
  }

  // --- Notas servicio y ensayo ---
  async function cargarNotas() {
    try {
      const docServicio = await db.collection('notas').doc('servicio').get();
      if(docServicio.exists) {
        notasServicio.value = docServicio.data().texto || '';
        fechaServicio.value = docServicio.data().fecha || '';
      }
      const docEnsayo = await db.collection('notas').doc('ensayo').get();
      if(docEnsayo.exists) {
        notasEnsayo.value = docEnsayo.data().texto || '';
        fechaEnsayo.value = docEnsayo.data().fecha || '';
      }
    } catch(e) {
      console.error('Error al cargar notas:', e);
    }
  }
  async function guardarNotas(tipo) {
    if(!currentUser || currentUser.uid !== ADMIN_UID) {
      alert('Solo el administrador puede guardar notas.');
      return;
    }
    let texto, fecha;
    if(tipo === 'servicio') {
      texto = notasServicio.value;
      fecha = fechaServicio.value;
    } else {
      texto = notasEnsayo.value;
      fecha = fechaEnsayo.value;
    }
    try {
      await db.collection('notas').doc(tipo).set({ texto, fecha });
      alert('Notas guardadas');
    } catch(e) {
      alert('
