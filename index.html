
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Repertorio Worship</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f9f9f9; margin: 0; padding: 0; transition: background-color 0.3s, color 0.3s; }
    body.dark-mode { background-color: #121212; color: #ffffff; }
    header { background-color: #002244; color: white; padding: 20px; text-align: center; position: relative; }
    #logo { width: 120px; height: auto; display: block; margin: 10px auto; }
    .btn { padding: 8px 16px; margin: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .btn.orange { background-color: orange; color: white; }
    .btn.blue { background-color: #00aaff; color: white; }
    .toggle-theme { position: absolute; top: 20px; right: 20px; font-size: 24px; background: none; border: none; color: white; cursor: pointer; }
    .metronome-left { position: absolute; top: 20px; left: 20px; font-size: 14px; padding: 6px 10px; }
    section { padding: 20px; }
    .section-card { border-radius: 10px; padding: 15px; margin-bottom: 20px; }
    .service-notes { background-color: #fff3cd; border-left: 6px solid orange; }
    .rehearsal-notes { background-color: #d1ecf1; border-left: 6px solid #00aaff; }
    footer { text-align: center; padding: 20px; color: gray; }
    #advanced-options { display: none; margin-top: 20px; }
    #song-list li { margin-bottom: 15px; }
  </style>
</head>
<body>
  <header>
    <a href="https://www.metronomeonline.com" class="btn blue metronome-left" target="_blank">üéµ Metr√≥nomo</a>
    <img src="logo.jpeg" alt="Logo" id="logo" />
    <h1>Repertorio Worship</h1>
    <button class="toggle-theme" onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
  </header>

  <section>
    <div class="section-card service-notes">
      <h3>Canciones para el pr√≥ximo servicio:</h3>
      <ul id="service-songs">
        <li>* Dame de beber</li>
        <li>* Mu√©vete en m√≠</li>
      </ul>
      <button class="btn orange" onclick="editNotes('service')">üìù Editar notas</button>
    </div>
    <div class="section-card rehearsal-notes">
      <h3>Canciones para el pr√≥ximo ensayo:</h3>
      <p id="rehearsal-text">No hay canciones programadas.</p>
      <button class="btn orange" onclick="editNotes('rehearsal')">üìù Editar notas</button>
    </div>
    <input id="search-input" type="text" placeholder="Buscar canciones..." style="width:100%;padding:10px;margin-top:10px;" />
    <p>Total: <span id="song-count">0</span> canciones.</p>
    <ul id="song-list"></ul>
    <button class="btn blue" onclick="scrollToTop()">üîç Volver al buscador</button>
    <div style="text-align: left;">
      <button class="btn orange" onclick="toggleAdvancedOptions()">‚öôÔ∏è Opciones avanzadas</button>
    </div>
    <div id="advanced-options">
      <form id="song-form" style="margin-top:10px;">
        <input type="text" placeholder="T√≠tulo de la canci√≥n" required /><br/>
        <input type="text" placeholder="Link de YouTube (opcional)" /><br/>
        <input type="file" accept="image/*" multiple /><br/>
        <input type="file" accept="audio/*" /><br/>
        <button type="submit" class="btn orange">Guardar canci√≥n</button>
      </form>
    </div>
  </section>

  <footer>Efesios 2:8</footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDahT6IuQwSYdpAMcPpAERpqVuobmqmVSQ",
      authDomain: "repertorioworship.firebaseapp.com",
      projectId: "repertorioworship",
      storageBucket: "repertorioworship.appspot.com",
      messagingSenderId: "493050453266",
      appId: "1:493050453266:web:cf07ce9fbb471122f167cb",
      measurementId: "G-RB3G81DQQ1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const songList = document.getElementById("song-list");
    const songForm = document.getElementById("song-form");
    const searchInput = document.getElementById("search-input");
    const songCount = document.getElementById("song-count");

    function updateSongCount() {
      songCount.innerText = songList.children.length;
    }

    function renderSong(docId, { title, ytLink, imageUrls, audioUrl }) {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${title}</strong><br/>
        ${ytLink ? `<a href="${ytLink}" target="_blank">üé¨ Ver en YouTube</a><br/>` : ""}
        ${imageUrls.map(url => `<img src="${url}" style="max-width:100px;">`).join("<br/>")}<br/>
        ${audioUrl ? `<audio controls src="${audioUrl}"></audio><br/>` : ""}
        <button class="btn orange" onclick="deleteSong('${docId}', this)">üóë Eliminar</button>
      `;
      li.setAttribute("data-title", title.toLowerCase());
      songList.appendChild(li);
      updateSongCount();
    }

    window.deleteSong = async function (id, btn) {
      await deleteDoc(doc(db, "songs", id));
      btn.parentElement.remove();
      updateSongCount();
    };

    songForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const [titleInput, ytInput] = e.target.querySelectorAll("input[type='text']");
      const title = titleInput.value;
      const ytLink = ytInput.value;
      const imageFiles = e.target.querySelector("input[type='file'][accept='image/*']").files;
      const audioFile = e.target.querySelector("input[type='file'][accept='audio/*']").files[0];

      const imageUrls = [];
      for (let i = 0; i < imageFiles.length && i < 2; i++) {
        const fileRef = ref(storage, `songs/${title}/image-${i + 1}`);
        await uploadBytes(fileRef, imageFiles[i]);
        imageUrls.push(await getDownloadURL(fileRef));
      }

      let audioUrl = "";
      if (audioFile) {
        const audioRef = ref(storage, `songs/${title}/audio`);
        await uploadBytes(audioRef, audioFile);
        audioUrl = await getDownloadURL(audioRef);
      }

      const docRef = await addDoc(collection(db, "songs"), { title, ytLink, imageUrls, audioUrl, created: new Date() });
      renderSong(docRef.id, { title, ytLink, imageUrls, audioUrl });
      e.target.reset();
    });

    (await getDocs(collection(db, "songs"))).forEach(doc => renderSong(doc.id, doc.data()));

    searchInput.addEventListener("input", () => {
      const filter = searchInput.value.toLowerCase();
      Array.from(songList.children).forEach(li => {
        li.style.display = li.getAttribute("data-title").includes(filter) ? "block" : "none";
      });
    });

    window.toggleTheme = () => document.body.classList.toggle("dark-mode");
    window.scrollToTop = () => window.scrollTo({ top: 0, behavior: "smooth" });
    window.toggleAdvancedOptions = () => {
      const el = document.getElementById("advanced-options");
      el.style.display = el.style.display === "block" ? "none" : "block";
    };
    window.editNotes = function (type) {
      const el = type === 'service' ? document.getElementById('service-songs') : document.getElementById('rehearsal-text');
      const newText = prompt("Editar contenido:", el.innerText);
      if (newText !== null) {
        if (type === 'service') {
          el.innerHTML = newText.split('\n').map(line => `<li>* ${line}</li>`).join('');
        } else {
          el.innerText = newText;
        }
      }
    };
  </script>
</body>
</html>
